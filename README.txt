Problems:
 * It was not tested on windows, so it may break with '\r\n'
 * Joining atoms when the first one is an empty line, usually breaks
 * After some, apparently, random number of edits, the editor may crash
